<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{base :: layout(~{::section})}">
<body>
<section>
  <h2 class="fw-bold mb-3">근속연한 / 인사이력 조회</h2>

  <!-- 검색 / 필터 영역 (필요하면 나중에 기능 연결) -->
  <div class="card p-3 shadow-sm mb-3">
    <form class="row g-2 align-items-center"
          th:action="@{/hr-history}"
          method="get">

      <!-- 검색 대상 선택 -->
      <div class="col-auto">
        <select class="form-select form-select-sm"
                name="searchField">
          <option th:value="empId"
                  th:selected="${searchField} == 'empId'">사번</option>
          <option th:value="empName"
                  th:selected="${searchField} == 'empName'">이름</option>
          <option th:value="changeType"
                  th:selected="${searchField} == 'changeType'">유형</option>
        </select>
      </div>

      <!-- 검색어 입력 -->
      <div class="col-auto">
        <input class="form-control form-control-sm"
               type="text"
               name="keyword"
               placeholder="검색어를 입력하세요"
               th:value="${keyword}">
      </div>

      <!-- 조회 버튼 -->
      <div class="col-auto">
        <button class="btn btn-outline-secondary btn-sm" type="submit">
          조회
        </button>
      </div>
    </form>
  </div>

  <!-- 테이블 영역 -->
  <div class="card p-3 shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead>
        <tr>
		  <th style="width:15%;">변경일</th>
          <th style="width:10%;">사번</th>
          <th style="width:20%;">이름</th>
		  <th style="width:12%;">유형</th>
          <th>인사이력</th>
        </tr>
        </thead>
		<tbody>
		<tr th:each="h : ${histories}">
		    <td th:text="${#temporals.format(h.changeDate, 'yyyy-MM-dd')}"></td>
		    <td th:text="${h.empId}"></td>
		    <td th:text="${h.empName}"></td>
		    <td th:text="${h.changeType}"></td>

		    <td>
		        <!-- 부서 변경이 있을 경우 -->
		        <span th:if="${h.beforeDeptName != h.afterDeptName}">
		            <span th:text="${h.beforeDeptName != null ? h.beforeDeptName : '-'}"></span>
		            <span> → </span>
		            <span th:text="${h.afterDeptName != null ? h.afterDeptName : '-'}"></span>
		        </span>

		        <!-- 부서&직급 모두 변경 시 구분자 출력 -->
		        <span th:if="${h.beforeDeptName != h.afterDeptName 
		                      and h.beforePositionName != h.afterPositionName}">
		            &nbsp;/&nbsp;
		        </span>

		        <!-- 직급 변경이 있을 경우 -->
		        <span th:if="${h.beforePositionName != h.afterPositionName}">
		            <span th:text="${h.beforePositionName != null ? h.beforePositionName : '-'}"></span>
		            <span> → </span>
		            <span th:text="${h.afterPositionName != null ? h.afterPositionName : '-'}"></span>
		        </span>
		    </td>
		</tr>

		<tr th:if="${#lists.isEmpty(histories)}">
		    <td colspan="5" class="text-center text-muted">인사이력 데이터가 없습니다</td>
		</tr>
		</tbody>
      </table>
    </div>
  </div>
</section>
</body>
</html>
