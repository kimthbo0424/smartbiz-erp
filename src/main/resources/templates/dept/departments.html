<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{base :: layout(~{::section})}">
<body>
<section>
  <div class="d-flex align-items-center mb-3">
    <h2 class="fw-bold me-auto">부서 관리</h2>
    <a th:href="@{/departments/form}" class="btn btn-primary btn-sm">부서 추가</a>
  </div>

  <div class="card p-3 shadow-sm">
    <!-- 부서 목록 테이블 -->
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead>
        <tr>
         <th style="width:10%;">ID</th>
         <th style="width:35%;">부서명</th>
         <th style="width:35%;">상위부서</th>
         <th style="width:20%;">액션</th>
        </tr>
        </thead>
        <tbody>
        <!-- 부서 목록 루프: model.addAttribute("departments", ...) 기준 -->
        <tr th:each="dept : ${departments}">
          <td th:text="${dept.deptId}">1</td>
          <td th:text="${dept.name}">영업팀</td>
          <!-- parent_id 만 컬럼에 있으므로 일단 ID 표시 -->
        <td th:text="${dept.parentName} ?: '최상위 부서'">최상위 부서</td>
          <td>
            <a class="btn btn-sm btn-outline-secondary"
               th:href="@{/departments/form(id=${dept.deptId})}">수정</a>
            <form th:action="@{/departments/delete}"
                  method="post"
                  class="d-inline">
             <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <input type="hidden" name="id" th:value="${dept.deptId}" />

              <button type="submit" class="btn btn-sm btn-outline-danger"
                      onclick="return confirm('삭제하시겠습니까?');">
                삭제
              </button>
            </form>
          </td>
        </tr>

        <!-- 목록이 없을 때 -->
        <tr th:if="${#lists.isEmpty(departments)}">
          <td colspan="4" class="text-center text-muted py-3">
            등록된 부서가 없습니다.
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</section>
</body>
</html>
