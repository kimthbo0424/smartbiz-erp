<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{base :: layout(~{::section})}">
<body>
<section>

  <h2 class="fw-bold mb-3">상품 공급사 목록</h2>

  <div class="card p-3 shadow-sm">

    <div class="d-flex justify-content-between mb-3">
      <button class="btn btn-sm btn-success" onclick="goCreate()">
        공급사 등록
      </button>
    </div>

    <table class="table table-sm table-hover align-middle">
      <thead class="table-light">
      <tr>
        <th>공급사(거래처)</th>
        <th>공급사 SKU</th>
        <th>리드타임</th>
        <th>대표여부</th>
        <th style="width:140px"></th>
      </tr>
      </thead>
      <tbody id="supplierTable">
      <!-- JS 렌더링 -->
      </tbody>
    </table>

  </div>

  <script>
    // URL: /product-supplier/product/{productId}
  	const productId = location.pathname.split("/")[3];

    document.addEventListener("DOMContentLoaded", loadSuppliers);

    function loadSuppliers() {
      fetch(`/api/product-suppliers/by-product/${productId}`)
        .then(r => r.json())
        .then(res => {
          if (!res.success) {
            alert("공급사 목록 조회 실패");
            return;
          }
          renderTable(res.data);
        });
    }

    function renderTable(list) {
      const tbody = document.getElementById("supplierTable");
      tbody.innerHTML = "";

      if (list.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="text-center text-muted">
              등록된 공급사가 없습니다.
            </td>
          </tr>
        `;
        return;
      }

      list.forEach(s => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${s.supplierName}</td>
          <td>${s.supplierSku ?? "-"}</td>
          <td>${s.leadTime ?? "-"}</td>
          <td>
            ${s.isPrimary
              ? '<span class="badge bg-primary">대표</span>'
              : ''}
          </td>
          <td class="text-end">
          <a class="btn btn-sm btn-secondary"
        	   href="/product-supplier/${s.id}/detail">
        	  상세
        	</a>
            <button class="btn btn-sm btn-danger ms-1"
                    onclick="deleteSupplier(${s.id})">
              삭제
            </button>
          </td>
        `;

        tbody.appendChild(tr);
      });
    }

    function deleteSupplier(id) {
      if (!confirm("삭제하시겠습니까?")) return;

      fetch(`/api/product-suppliers/${id}`, { method: "DELETE" })
        .then(r => {
          if (r.status === 204) {
            loadSuppliers();
          } else {
            alert("삭제 실패");
          }
        });
    }

    function goCreate() {
      location.href = `/product-supplier/product/${productId}/create`;
    }
  </script>

</section>
</body>
</html>
