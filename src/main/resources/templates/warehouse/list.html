<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{base :: layout(~{::section})}">
<body>
<section>
    <h2 class="fw-bold mb-4">창고 관리</h2>

    <div class="mb-3">
        <a th:href="@{/warehouse/create}" class="btn btn-primary btn-sm">
            창고 등록
        </a>
    </div>

    <div class="table-responsive bg-white rounded shadow-sm">
        <table class="table table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>창고명</th>
                <th>코드</th>
                <th>위치</th>
                <th>담당자</th>
                <th>수용량</th>
                <th>상태</th>
                <th>관리</th>
            </tr>
            </thead>

            <tbody id="warehouseTableBody">
            </tbody>
        </table>
    </div>
<script>
document.addEventListener("DOMContentLoaded", () => {
    loadWarehouses();
});

function loadWarehouses() {
    fetch("/api/warehouse")
        .then(res => res.json())
        .then(result => {
            const tbody = document.getElementById("warehouseTableBody");
            tbody.innerHTML = "";

            result.data.forEach(wh => {
                const tr = document.createElement("tr");

                tr.innerHTML = `
                    <td>${wh.id}</td>
                    <td>${wh.name}</td>
                    <td>${wh.code}</td>
                    <td>${wh.location}</td>
                    <td>${wh.manager ?? ""}</td>
                    <td>${wh.capacity ?? ""}</td>
                    <td>
                        ${wh.isActive
                            ? '<span class="badge bg-success">운영중</span>'
                            : '<span class="badge bg-secondary">비활성</span>'}
                    </td>
                    <td class="d-flex gap-1">
                        <a href="/warehouse/detail/${wh.id}"
                           class="btn btn-sm btn-outline-primary">
                            상세
                        </a>

                        <a href="/warehouse/edit/${wh.id}"
                           class="btn btn-sm btn-outline-warning">
                            수정
                        </a>

                        <button class="btn btn-sm btn-outline-danger"
                                onclick="deactivateWarehouse(${wh.id})"
                                ${wh.isActive ? "" : "disabled"}>
                            비활성화
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        })
        .catch(err => {
            console.error(err);
            alert("창고 목록을 불러오는 데 실패했습니다.");
        });
}

function deactivateWarehouse(id) {
    if (!confirm("창고를 비활성화하시겠습니까?")) return;

    fetch(`/api/warehouse/${id}`, {
        method: "DELETE"
    }).then(res => {
        if (res.status === 204) {
            loadWarehouses(); // 새로고침 대신 재조회
        } else {
            alert("비활성화 처리에 실패했습니다.");
        }
    });
}
</script>
</section>
</body>
</html>