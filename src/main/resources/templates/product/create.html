<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{base :: layout(~{::section})}">
<body>
<section>

<h2 class="fw-bold mb-4">상품 등록</h2>

<div class="card p-4 shadow-sm">

    <div class="mb-3">
        <label class="form-label">상품명</label>
        <input type="text" class="form-control" id="name" required>
    </div>

    <div class="mb-3">
        <label class="form-label">SKU</label>
        <input type="text" class="form-control" id="sku" required>
    </div>

    <div class="mb-3">
        <label class="form-label">바코드</label>
        <input type="text" class="form-control" id="barcode">
    </div>

    <div class="mb-3">
        <label class="form-label">단가</label>
        <input type="number" step="0.01" class="form-control" id="unitPrice">
    </div>

    <div class="mb-3">
        <label class="form-label">원가</label>
        <input type="number" step="0.01" class="form-control" id="costPrice">
    </div>

    <div class="mb-3">
        <label class="form-label">상태</label>
        <select id="status" class="form-select">
            <option value="ACTIVE">ACTIVE</option>
            <option value="DISCONTINUED">DISCONTINUED</option>
        </select>
    </div>

    <div class="mb-3">
        <label class="form-label">카테고리</label>
        <select id="categoryId" class="form-select" required></select>
    </div>

    <div class="form-check mb-3">
        <input class="form-check-input" type="checkbox" id="isActive" checked>
        <label class="form-check-label">활성화</label>
    </div>

    <div class="d-flex justify-content-between">
        <a href="/product/list" class="btn btn-secondary">취소</a>
        <button class="btn btn-primary" onclick="createProduct()">등록</button>
    </div>

</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
    loadCategories();
});

async function loadCategories() {
    const res = await fetch("/api/categories");
    const list = (await res.json()).data;

    const select = document.getElementById("categoryId");
    list.forEach(c => {
        const opt = document.createElement("option");
        opt.value = c.id;
        opt.textContent = c.name;
        select.appendChild(opt);
    });
}

async function createProduct() {
    const body = {
        name: document.getElementById("name").value,
        sku: document.getElementById("sku").value,
        barcode: document.getElementById("barcode").value || null,
        unitPrice: document.getElementById("unitPrice").value || null,
        costPrice: document.getElementById("costPrice").value || null,
        status: document.getElementById("status").value,
        categoryId: document.getElementById("categoryId").value,
        isActive: document.getElementById("isActive").checked
    };

    const res = await fetch("/api/products", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
    });

    if (res.ok) {
        alert("상품이 등록되었습니다.");
        location.href = "/product/list";
    } else {
        alert("상품 등록 실패");
    }
}
</script>

</section>
</body>
</html>
