<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{base :: layout(~{::section})}">
<body>
<section>
    <h2 class="fw-bold mb-4">ì°½ê³  ìƒì„¸ ì •ë³´</h2>

    <div class="bg-white p-4 rounded shadow-sm">
        <table class="table table-bordered">
            <tbody>
            <tr>
                <th>ì°½ê³ ëª…</th>
                <td id="name"></td>
            </tr>
            <tr>
                <th>ì°½ê³  ì½”ë“œ</th>
                <td id="code">-</td>
            </tr>
            <tr>
                <th>ìœ„ì¹˜</th>
                <td id="location">-</td>
            </tr>
            <tr>
                <th>ë‹´ë‹¹ì</th>
                <td id="manager">-</td>
            </tr>
            <tr>
                <th>ìˆ˜ìš©ëŸ‰</th>
                <td id="capacity">-</td>
            </tr>
            <tr>
                <th>ìš´ì˜ ìƒíƒœ</th>
                <td id="status"></td>
            </tr>
            </tbody>
        </table>

        <div class="d-flex gap-2 mt-4">
            <a id="editBtn" class="btn btn-primary">ìˆ˜ì •</a>
            <a th:href="@{/warehouse/list}" class="btn btn-outline-secondary">ëª©ë¡</a>
            <button id="deactivateBtn" class="btn btn-danger">ë¹„í™œì„±í™”</button>
        </div>
    </div>

    <!-- ğŸ”¥ ë°˜ë“œì‹œ section ì•ˆ -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const id = getWarehouseId();
            loadWarehouse(id);
        });

        function getWarehouseId() {
            const parts = window.location.pathname.split("/");
            return parts[parts.length - 1];
        }

        function loadWarehouse(id) {
            fetch(`/api/warehouse/${id}`)
                .then(res => res.json())
                .then(result => {
                    const wh = result.data;

                    document.getElementById("name").textContent = wh.name;
                    document.getElementById("code").textContent = wh.code ?? "-";
                    document.getElementById("location").textContent = wh.location ?? "-";
                    document.getElementById("manager").textContent = wh.manager ?? "-";
                    document.getElementById("capacity").textContent = wh.capacity ?? "-";

                    document.getElementById("status").innerHTML =
                        wh.isActive
                            ? '<span class="badge bg-success">ìš´ì˜ ì¤‘</span>'
                            : '<span class="badge bg-secondary">ë¹„í™œì„±</span>';

                    document.getElementById("editBtn").href =
                        `/warehouse/edit/${wh.id}`;

                    const deactivateBtn = document.getElementById("deactivateBtn");
                    if (!wh.isActive) {
                        deactivateBtn.disabled = true;
                    } else {
                        deactivateBtn.onclick = () => deactivateWarehouse(wh.id);
                    }
                })
                .catch(err => {
                    console.error(err);
                    alert("ì°½ê³  ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                });
        }

        function deactivateWarehouse(id) {
            if (!confirm("ë¹„í™œì„±í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

            fetch(`/api/warehouse/${id}`, { method: "DELETE" })
                .then(res => {
                    if (res.status === 204) {
                        location.href = "/warehouse/list";
                    } else {
                        alert("ë¹„í™œì„±í™” ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    }
                });
        }
    </script>

</section>
</body>
</html>
