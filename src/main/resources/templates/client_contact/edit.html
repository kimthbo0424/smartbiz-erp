<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="~{base :: layout(~{::section})}">
<body>
<section>

  <h2 class="mb-4 fw-bold">담당자 수정</h2>

  <div class="card p-4 shadow-sm">

    <form th:action="@{/client/{cid}/contacts/{id}/edit(
                        cid=${client.id},
                        id=${contactId})}"
          method="post"
          th:object="${contact}">

      <!-- 거래처 -->
      <div class="mb-3">
        <label class="form-label">거래처</label>
        <input type="text" class="form-control"
               th:value="${client.name}" readonly>
      </div>

      <div class="mb-3">
        <label class="form-label">이름</label>
        <input type="text" class="form-control"
               th:field="*{name}" required>
      </div>

      <div class="mb-3">
        <label class="form-label">전화</label>
        <input type="text" class="form-control"
               th:field="*{phone}">
      </div>

      <div class="mb-3">
        <label class="form-label">직함</label>
        <input type="text" class="form-control"
               th:field="*{position}">
      </div>

      <div class="mb-3">
        <label class="form-label">이메일</label>
        <input type="email" class="form-control"
               th:field="*{email}">
      </div>

      <div class="form-check mb-4">
        <input class="form-check-input"
               type="checkbox"
               th:field="*{primary}">
        <label class="form-check-label">대표 담당자</label>
      </div>

      <div class="d-flex justify-content-between">

        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">저장</button>
          <a class="btn btn-secondary"
             th:href="@{/client/detail/{id}(id=${client.id}, tab='contacts')}">
            취소
          </a>
        </div>

        <button type="button"
                class="btn btn-outline-danger"
                onclick="deleteContact()">
          삭제
        </button>

      </div>

    </form>

  </div>
  <script>
    function deleteContact() {
      if (!confirm("담당자를 삭제하시겠습니까?\n이 작업은 되돌릴 수 없습니다.")) {
        return;
      }

      fetch("/client/[[${client.id}]]/contacts/[[${contactId}]]/delete", {
        method: "POST"
      }).then(res => {
        if (!res.ok) {
          alert("삭제 실패");
          return;
        }
        location.href = "/client/detail/[[${client.id}]]?tab=contacts";
      });
    }
  </script>

</section>
</body>
</html>